<!DOCTYPE HTML>
<html>
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

		<title>qUnit Page for sap.m.GrowingEnablement</title>

		<script id="sap-ui-bootstrap"
			src="../../../../resources/sap-ui-core.js"
			data-sap-ui-theme="sap_bluecrystal"
			data-sap-ui-noConflict="true"
			data-sap-ui-libs="sap.m">
		</script>

		<link rel="stylesheet" href="../../../../resources/sap/ui/thirdparty/qunit.css" type="text/css" media="screen" />
		<script src="../../../../resources/sap/ui/thirdparty/qunit.js"></script>
		<script src="/jsunit-testrunner/qunit/qunit-jsunit.js"></script>
		<script src="../../../../resources/sap/ui/qunit/QUnitUtils.js"></script>
		<script src="../../../../resources/sap/ui/thirdparty/sinon.js"></script>
		<script src="../../../../resources/sap/ui/thirdparty/sinon-qunit.js"></script>

		<script>

			jQuery.sap.require("sap.m.List");
			jQuery.sap.require("sap.m.GrowingEnablement");

			module("trigger or button?");

			function switchTriggerTestcase (bHasScrollbars, bShouldShowTrigger) {
				// System under Test
				var oGrowingEnablement = new sap.m.GrowingEnablement(new sap.m.List()),
					ojQueryStub = this.stub(oGrowingEnablement._oControl, "$", function () {
						//we need a valid jQuery node
						return jQuery("#qunit-fixture");
					});

				// Act
				oGrowingEnablement._checkTriggerType(true, bHasScrollbars);
				oGrowingEnablement._checkTriggerType(true, bHasScrollbars);

				// Assert
				strictEqual(oGrowingEnablement._showsTrigger, bShouldShowTrigger, "did show the trigger correctly");
				strictEqual(oGrowingEnablement._showsLoading, !bShouldShowTrigger, "did show the loading correctly");
				strictEqual(ojQueryStub.callCount, 1, "did modify the dom only once");
			}

			test("Should show the trigger", function() {
				switchTriggerTestcase.call(this, false, true);
			});

			test("Should show the loading indicator", function() {
				switchTriggerTestcase.call(this, true, false);
			});

			test("Should not change trigger if growing is not enabled", function() {
				// System under Test
				var oGrowingEnablement = new sap.m.GrowingEnablement(new sap.m.List()),
					ojQueryStub = this.stub(oGrowingEnablement._oControl, "$", function () {
						//we need a valid jQuery node
						return jQuery("#qunit-fixture");
					});

				// Act
				oGrowingEnablement._checkTriggerType(false, true);
				oGrowingEnablement._checkTriggerType(false, false);

				// Assert
				ok(!oGrowingEnablement._showsTrigger, "did not show the trigger");
				ok(!oGrowingEnablement._showsLoading, "did not show the loading");
				strictEqual(ojQueryStub.callCount, 0, "did not modify the dom");
			});

			module("Integration tests");

			test("Should determine if the list is scrollable", function() {
				//Arrange
				var data = { items: [ {},{}] };
			
				var model = new sap.ui.model.json.JSONModel();
				model.setData(data);

				var list = new sap.m.List({
					growing : true,
					growingScrollToLoad : true,
					items : {
					path : "/items", 
					template : new sap.m.CustomListItem({
							content : new sap.ui.core.HTML({content:'<div style="height: 1000px"></div>'}),
						}) 
					}
				}).setModel(model);

				var page = new sap.m.Page({
					title: "List Page",
					content : list
				});

				//System under Test
				var sut = new sap.m.GrowingEnablement(list);

				page.placeAt("qunit-fixture");
				sap.ui.getCore().applyChanges();

				//Act + Assert
				ok(sut._getHasScrollbars(), "The list has scrollbars");
			});

			test("Should determine if the list is not scrollable", function() {
				//Arrange
				var list = new sap.m.List({
						growing : true,
						growingScrollToLoad : true
					});

				//System under Test
				var sut = new sap.m.GrowingEnablement(list);

				list.placeAt("qunit-fixture");
				sap.ui.getCore().applyChanges();

				//Act + Assert
				ok(!sut._getHasScrollbars(), "The list has no scrollbars");
			});
		</script>

	</head>
	<body id="body" class="sapUiBody">
		<h1 id="qunit-header">qUnit Page for sap.m.GrowingEnablement</h1>
		<h2 id="qunit-banner"></h2>
		<h2 id="qunit-userAgent"></h2>
		<ol id="qunit-tests"></ol>

		<div id="qunit-fixture"></div>
	</body>
</html>